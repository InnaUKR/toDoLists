<div class="panel panel-default" id="row_<%=task.id %>" data-id="<%= task.id %>">
  <div class="row">
    <div class="complete">
      <% if task.completeda? %>

            <div class="col-xs-1">
          <%=link_to complete_task_path(project_id: project, id: task), remote: true, method: :patch do%>
              <input id="#check_<%=task.id%>" type="checkbox" checked/>
          <% end %>
            </div>

          <div class="<%= task.id %> col-xs-4">
            <%= task.title%>
          </div>

      <% else %>

            <div class="col-xs-1">
          <%=link_to complete_task_path(project_id: project, id: task), remote: true, method: :patch do%>
              <input id="#check_<%=task.id%>" type="checkbox"/>
          <% end %>
            </div>

          <div class="<%= task.id %> col-xs-4">
            <%= task.title%>
          </div>

      <% end %>
      <div class="col-xs-2">
      <div class="star-priority" data-score= <%= task.priority %>></div>
      </div>
      <div class="col-xs-3">
        <% require 'date'%>
        <% if !task.deadline.nil? %>
            <%= task.deadline.strftime("%d-%m-%Y  %H:%M %p") %>
            <% else %>
        <%= 'someday:)' %>
        <% end %>
      </div>

      <div class="col-xs-2">

        <span class="trash">
          <%= link_to '<i class="glyphicon glyphicon-trash"></i>'.html_safe, task_path(project_id: project, id: task), remote: true,
                          method: :delete,
                          data: {confirm: 'Are you sure?'} %>
        </span>

        <span class="update">
          <%=link_to '<i class="glyphicon glyphicon-pencil"></i>'.html_safe, edit_task_path(project_id: project, id: task), remote: true%>
        </span>

      </div>
    </div>
  </div>
</div>

<script>
    $('.star-priority').raty({
        path: '/assets',
        readOnly: true,
        score: function() {
            return $(this).attr('data-score');
        }
    });










    var ready, set_positions;

    set_positions = function(){
        // loop through and give each task a data-pos
        // attribute that holds its position in the DOM
        $('.panel.panel-default').each(function(i){
            $(this).attr("data-pos",i+1);
        });
    }

    ready = function(){

        // call set_positions function
        set_positions();

        $('.sortable').sortable();

        // after the order changes
        $('.sortable').sortable().bind('sortupdate', function(e, ui) {
            // array to store new order
            updated_order = []
            // set the updated positions
            set_positions();

            // populate the updated_order array with the new task positions
            $('.panel.panel-default').each(function(i){
                updated_order.push({ id: $(this).data("id"), position: i+1 });
            });

            // send the updated order via ajax
            $.ajax({
                type: "PUT",
                url: '/tasks/sort',
                data: { order: updated_order }
            });
        });
    }

    $(document).ready(ready);
    $(document).on('page:load', ready);
</script>